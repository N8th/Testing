<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video Clip Trimmer - Version 1.0.2</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #ffffff;
      margin: 20px;
    }
    h1 {
      color: #00ff00;
    }
    #upload-box {
      border: 2px dashed #00ff00;
      padding: 50px;
      text-align: center;
      font-size: 18px;
      color: #00ff00;
      cursor: pointer;
      margin-bottom: 20px;
    }
    #upload-box.dragging {
      background-color: #333333;
    }
    button {
      background-color: #00ff00;
      color: #121212;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 20px;
    }
    button:disabled {
      background-color: #444444;
      cursor: not-allowed;
    }
  </style>
</head>
<body>

  <h1>Upload and Trim Videos (Version 1.0.2)</h1>
  
  <div id="upload-box">Drag and drop your videos here or click to upload</div>
  <input type="file" id="video-input" accept="video/*" multiple style="display: none;">
  <button id="process-button" disabled>Process and Save Clips</button>

  <script src="https://cdn.jsdelivr.net/npm/ffmpeg.js/ffmpeg.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <script>
    const uploadBox = document.getElementById('upload-box');
    const videoInput = document.getElementById('video-input');
    const processButton = document.getElementById('process-button');
    let videoFiles = [];
    let zip = new JSZip();

    // Handle drag-and-drop functionality
    uploadBox.addEventListener('dragover', (event) => {
      event.preventDefault();
      uploadBox.classList.add('dragging');
    });

    uploadBox.addEventListener('dragleave', () => {
      uploadBox.classList.remove('dragging');
    });

    uploadBox.addEventListener('drop', (event) => {
      event.preventDefault();
      uploadBox.classList.remove('dragging');
      handleFiles(event.dataTransfer.files);
    });

    uploadBox.addEventListener('click', () => {
      videoInput.click();
    });

    videoInput.addEventListener('change', (event) => {
      handleFiles(event.target.files);
    });

    function handleFiles(files) {
      videoFiles = Array.from(files);
      processButton.disabled = videoFiles.length === 0;
    }

    // Process videos and save clips
    processButton.addEventListener('click', async () => {
      processButton.disabled = true;
      zip = new JSZip();

      for (let file of videoFiles) {
        const trimmedVideos = await processVideo(file);
        trimmedVideos.forEach((blob, index) => {
          zip.file(`${file.name.split('.')[0]}-clip-${index}.mp4`, blob);
        });
      }

      // Save the zip
      zip.generateAsync({ type: 'blob' }).then(function (content) {
        saveAs(content, 'trimmed-clips.zip');
      });

      processButton.disabled = false;
    });

    async function processVideo(file) {
      const ffmpeg = await FFmpeg.createFFmpeg({ log: true });
      await ffmpeg.load();

      const { name } = file;
      const videoData = await file.arrayBuffer();

      ffmpeg.FS('writeFile', name, new Uint8Array(videoData));

      // Trim into random 4-10 second clips
      const duration = 10;  // Example duration for trimming
      const startTime = Math.random() * (duration - 10);  // Random start time
      const trimmedClips = [];

      for (let i = 0; i < 3; i++) {  // Example trimming into 3 clips
        const output = `clip-${i}.mp4`;
        await ffmpeg.run('-i', name, '-ss', `${startTime}`, '-t', '10', '-c', 'copy', output);
        const data = ffmpeg.FS('readFile', output);
        trimmedClips.push(new Blob([data.buffer], { type: 'video/mp4' }));
        ffmpeg.FS('unlink', output);
      }

      return trimmedClips;
    }
  </script>

</body>
</html>